
<?php if ( ! defined('BASEPATH')) exit('No direct script access allowed');
session_start(); 
class Welcome extends CI_Controller {

	public function index()
	{
		$this->load->view('home');
	}
        public function login() {
		$this->load->view('login');
         }
        public function register() {
		$this->load->view('register');
         }
        public function s() {
	      if($this->session->userdata('logged_in'))
               { 
     			$session_data = $this->session->userdata('logged_in');
			$data['email'] = $session_data['email'];
		        $this->load->view('s',$data);
   		}
               else 
	          $this->load->view('register');
         }
        public function checkAvailability() {
		$email=$_POST['email'];	
		$data=array("email" => $email);
		$data_string=json_encode($data);
		$ch=curl_init('http://localhost:8080/HundredAcres/webapi/resource/checkemail');
		curl_setopt($ch, CURLOPT_CUSTOMREQUEST, "POST");                                                                     
		curl_setopt($ch, CURLOPT_POSTFIELDS, $data_string);                                                                  
		curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);                                                                      
		curl_setopt($ch, CURLOPT_HTTPHEADER, array(                                                                          
	    	'Content-Type: application/json',                                                                                
	    	'Content-Length: ' . strlen($data_string))
		);
		$result = curl_exec($ch);
		echo $result;
         }

        public function regAPI() {
		$name=$_POST['Name'];
	$email=$_POST['email'];
	$pwd=$_POST['Password'];
	$no=$_POST['no'];
	$data=array("name" => $name, "email" => $email, "password" => $pwd, "no" => $no);
	$data_string=json_encode($data);
	$ch=curl_init('http://localhost:8080/HundredAcres/webapi/resource/reg');
	curl_setopt($ch, CURLOPT_CUSTOMREQUEST, "POST");                                                                     
	curl_setopt($ch, CURLOPT_POSTFIELDS, $data_string);                                                                  
	curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);                                                                      
	curl_setopt($ch, CURLOPT_HTTPHEADER, array(                                                                          
    	'Content-Type: application/json',                                                                                
    	'Content-Length: ' . strlen($data_string))
	);
	$result = curl_exec($ch);
	if ($result=="Success")
          $this->load->view('afterRegister');
        else
          $this->load->view('register');
         
         }

        public function check() {
		$email=$_POST['Email'];
	$pwd=$_POST['Password'];
	

	$data=array("email" => $email, "password" => $pwd);
	$data_string=json_encode($data);
	$ch=curl_init('http://localhost:8080/HundredAcres/webapi/resource/check');
	curl_setopt($ch, CURLOPT_CUSTOMREQUEST, "POST");                                                                     
	curl_setopt($ch, CURLOPT_POSTFIELDS, $data_string);                                                                  
	curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);                                                                      
	curl_setopt($ch, CURLOPT_HTTPHEADER, array(                                                                          
    	'Content-Type: application/json',                                                                                
    	'Content-Length: ' . strlen($data_string))
	);
	$result = curl_exec($ch);

        if ($result=='Welcome')
       {
        $this->session->set_userdata('logged_in', $data);
        if($this->session->userdata('logged_in'))
   {
     $session_data = $this->session->userdata('logged_in');
     $data['email'] = $session_data['email'];
     $this->load->view('profile',$data);
   }
}
       else {
    $this->load->view('sorry');
       
        }
         
         }
public function logout() {
   $this->session->unset_userdata('logged_in');
   session_destroy();
   $this->load->view('home');
         }

public function addproperty()
{
$this->load->model('property_model');//loads the property_model.php file in models folder
if($this->property_model->add_user())
{
echo "hi added successfully" ;
}
else
{
echo " failed";
}
}
     

}?>


